<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Novo Aluno</title>
  <link rel="stylesheet" href="style.css">
  <script src="common.js" defer></script>
</head>
<body>
  <!-- Menu lateral será preenchido pelo JS -->
  <div id="menu-container"></div>

  <main>
    <div class="container">
      <h2>Novo Aluno</h2>
      
      <div id="feedback-message" class="feedback-message" style="display:none;"></div>
      
      <form id="form-novo-aluno" action="#" method="post">
        <!-- Campos do Aluno -->
        <div class="form-group">
          <label for="nome">Nome do Aluno</label>
          <input type="text" id="nome" name="nome" required>
          <span id="nome-error" class="error-message"></span>
        </div>
        <div class="form-group">
          <label for="sobrenome">Sobrenome do Aluno</label>
          <input type="text" id="sobrenome" name="sobrenome" required>
          <span id="sobrenome-error" class="error-message"></span>
        </div>
        <div class="form-group">
          <label for="documento">Documento de Identidade do Aluno</label>
          <input type="text" id="documento" name="documento" required>
          <span id="documento-error" class="error-message"></span>
        </div>
        <div class="form-group">
          <label for="idade">Idade do Aluno</label>
          <input type="number" id="idade" name="idade" required>
          <span id="idade-error" class="error-message"></span>
        </div>
        <div class="form-group">
          <label for="sexo">Sexo do Aluno</label>
          <select id="sexo" name="sexo" required>
            <option value="">Selecione</option>
            <option value="M">Masculino</option>
            <option value="F">Feminino</option>
            <option value="O">Outro</option>
          </select>
          <span id="sexo-error" class="error-message"></span>
        </div>
        <!-- data_matricula será preenchida automaticamente -->

        <!-- Campos do Responsável -->
        <div class="form-group">
          <label for="responsavel_nome">Nome do Responsável</label>
          <input type="text" id="responsavel_nome" name="responsavel_nome" required>
          <span id="responsavel_nome-error" class="error-message"></span>
        </div>
        <div class="form-group">
          <label for="responsavel_documento">Documento do Responsável</label>
          <input type="text" id="responsavel_documento" name="responsavel_documento" required>
          <span id="responsavel_documento-error" class="error-message"></span>
        </div>
        <div class="form-group">
          <label for="responsavel_email">Email do Responsável</label>
          <input type="email" id="responsavel_email" name="responsavel_email">
        </div>
        <div class="form-group">
          <label for="responsavel_telefone">Telefone do Responsável</label>
          <input type="text" id="responsavel_telefone" name="responsavel_telefone" required>
          <span id="responsavel_telefone-error" class="error-message"></span>
        </div>
        <div class="form-group">
          <label for="responsavel_rua">Rua</label>
          <input type="text" id="responsavel_rua" name="responsavel_rua">
        </div>
        <div class="form-group">
          <label for="responsavel_numero">Número</label>
          <input type="text" id="responsavel_numero" name="responsavel_numero">
        </div>
        <div class="form-group">
          <label for="responsavel_bairro">Bairro</label>
          <input type="text" id="responsavel_bairro" name="responsavel_bairro">
        </div>
        <div class="form-group">
          <label for="responsavel_cidade">Cidade</label>
          <input type="text" id="responsavel_cidade" name="responsavel_cidade">
        </div>
        <div class="form-group">
          <label for="responsavel_endereco_complemento">Complemento do Endereço</label>
          <input type="text" id="responsavel_endereco_complemento" name="responsavel_endereco_complemento">
        </div>

        <div class="form-actions">
          <button type="submit">Salvar</button>
        </div>
      </form>
    </div>
  </main>

  <script src="menu.js" defer></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // BACKEND: Carregar o menu e barra superior
      // O menu.js já faz isso, mas se precisar de dados do backend para o menu, inserir aqui.

      const form = document.getElementById("form-novo-aluno");
      if (!form) return;

      form.addEventListener("submit", async function(e){
        e.preventDefault();

        // Limpar mensagens de erro anteriores
        UI.clearFormErrors("form-novo-aluno");

        // Validar campos obrigatórios
        const nomeAlunoValid = UI.validateRequired("nome", "nome-error");
        const sobrenomeAlunoValid = UI.validateRequired("sobrenome", "sobrenome-error");
        const documentoAlunoValid = UI.validateRequired("documento", "documento-error");
        const idadeAlunoValid = UI.validateRequired("idade", "idade-error");
        const sexoAlunoValid = UI.validateRequired("sexo", "sexo-error");
        const nomeResponsavelValid = UI.validateRequired("responsavel_nome", "responsavel_nome-error");
        const documentoResponsavelValid = UI.validateRequired("responsavel_documento", "responsavel_documento-error");
        const telefoneResponsavelValid = UI.validateRequired("responsavel_telefone", "responsavel_telefone-error");

        if (!nomeAlunoValid || !sobrenomeAlunoValid || !documentoAlunoValid || !idadeAlunoValid || !sexoAlunoValid || !nomeResponsavelValid || !documentoResponsavelValid || !telefoneResponsavelValid) {
          UI.showMessage("Por favor, preencha todos os campos obrigatórios.", "error");
          return;
        }

        const novoAluno = {
          nome: document.getElementById("nome").value.trim(),
          sobrenome: document.getElementById("sobrenome").value.trim(),
          documento: document.getElementById("documento").value.trim(),
          idade: parseInt(document.getElementById("idade").value),
          sexo: document.getElementById("sexo").value,
          data_matricula: new Date().toISOString().split('T')[0], // Data atual
          responsavel: {
            nome: document.getElementById("responsavel_nome").value.trim(),
            documento: document.getElementById("responsavel_documento").value.trim(),
            email: document.getElementById("responsavel_email").value.trim(),
            telefone: document.getElementById("responsavel_telefone").value.trim(),
            rua: document.getElementById("responsavel_rua").value.trim(),
            numero: document.getElementById("responsavel_numero").value.trim(),
            bairro: document.getElementById("responsavel_bairro").value.trim(),
            cidade: document.getElementById("responsavel_cidade").value.trim(),
            endereco_complemento: document.getElementById("responsavel_endereco_complemento").value.trim()
          }
        };

        try {
          // BACKEND: Substituir esta simulação pela chamada à API de criação de aluno
          const response = await API.post("/aluno", novoAluno);

          console.log("Aluno cadastrado com sucesso:", response);
          UI.showMessage("Aluno cadastrado com sucesso!", "success");
          
          // Limpar formulário após sucesso
          form.reset();
          
          // BACKEND: Opcional: redirecionar para a página de listagem de alunos
          // setTimeout(() => {
          //   window.location.href = "alunos.html";
          // }, 2000);
          
        } catch (error) {
          console.error("Erro ao cadastrar aluno:", error);
          UI.showMessage(error.message || "Erro ao cadastrar aluno. Tente novamente.", "error");
        }
      });
    });
  </script>
</body>
</html>
